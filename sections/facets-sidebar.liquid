<!-- Sidebar Filters -->
<aside class="collections-sidebar">
  <h3 class="sidebar-title">Filter By</h3>

  {% if collection.filters.size > 0 %}
    <form id="CollectionFiltersForm" class="sidebar-form">
      {% for filter in collection.filters %}
        <div class="filter-group">
          <h4 class="filter-title">{{ filter.label }}</h4>

          {% if filter.type == "price_range" %}
            <div class="price-range">
              <label>
                From
                <input type="number"
                       name="{{ filter.min_value.param_name }}"
                       value="{{ filter.min_value.value | default: '' }}"
                       min="0"
                       step="1">
              </label>
              <label>
                To
                <input type="number"
                       name="{{ filter.max_value.param_name }}"
                       value="{{ filter.max_value.value | default: '' }}"
                       min="0"
                       step="1">
              </label>
              <button type="submit" class="btn-apply">Apply</button>
            </div>
          {% else %}
            <ul class="filter-options">
              {% for value in filter.values %}
                <li>
                  <label>
                    <input type="checkbox"
                           name="{{ filter.param_name }}"
                           value="{{ value.value }}"
                           {% if value.active %}checked{% endif %}
                           onchange="this.form.submit()">
                    {{ value.label }} ({{ value.count }})
                  </label>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      {% endfor %}
      
      <!-- Collection Filter -->
      <div class="filter-group">
        <h4 class="filter-title">Collection</h4>
        <ul class="filter-options">
          <li>
            <input type="radio"
                   name="collection_filter"
                   value=""
                   class="collection-filter-radio"
                   id="collection-all"
                   {% if collection.handle == 'all' or collection.handle == blank %}checked{% endif %}
                   onchange="handleCollectionFilter(this)">
            <label for="collection-all">All Collections</label>
          </li>
          {%- liquid
            assign all_collections = collections
            assign sorted_collections = all_collections | sort: 'title'
          -%}
          {%- for collection_item in sorted_collections -%}
            {%- if collection_item.all_products_count > 0 -%}
              <li>
                <input type="radio"
                       name="collection_filter"
                       value="{{ collection_item.handle }}"
                       class="collection-filter-radio"
                       id="collection-{{ collection_item.handle }}"
                       data-collection-url="{{ collection_item.url }}"
                       {% if collection.handle == collection_item.handle %}checked{% endif %}
                       onchange="handleCollectionFilter(this)">
                <label for="collection-{{ collection_item.handle }}">{{ collection_item.title }} ({{ collection_item.all_products_count }})</label>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </div>
    </form>
  {% else %}
    <p>No filters available</p>
  {% endif %}
</aside>

<script>
function handleCollectionFilter(selectedRadio) {
  const collectionUrl = selectedRadio.getAttribute('data-collection-url');
  
  // If "All Collections" is selected, redirect to all products page
  if (selectedRadio.value === '') {
    window.location.href = '/collections/all';
  } else if (collectionUrl) {
    // If a specific collection is selected, redirect to that collection
    window.location.href = collectionUrl;
  }
}
</script>
